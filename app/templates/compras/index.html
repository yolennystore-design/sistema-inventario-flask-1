{% extends "layout/base.html" %}
{% block title %}Compras{% endblock %}

{% block content %}
<h2 class="mb-3">ðŸ›’ Compras</h2>

<!-- =========================
     FORMULARIO AGREGAR COMPRA
========================= -->
<form method="POST"
      action="{{ url_for('compras.agregar') }}"
      class="row g-3 mb-4">

    <!-- PRODUCTO -->
    <div class="col-md-4">
        <label class="form-label">Producto</label>
        <select name="id_producto" id="productoSelect" class="form-select" required>
            <option value="">Seleccione producto</option>
            {% for p in productos %}
            <option value="{{ p.id }}"
                    data-nombre="{{ p.nombre }}"
                    data-stock="{{ p.cantidad }}">
                {{ p.nombre }} (Stock: {{ p.cantidad }})
            </option>
            {% endfor %}
        </select>

        <!-- nombre del producto (hidden) -->
        <input type="hidden" name="producto" id="productoNombre">
    </div>

    <!-- CANTIDAD -->
    <div class="col-md-2">
        <label class="form-label">Cantidad</label>
        <input type="number"
               name="cantidad"
               class="form-control"
               min="1"
               required>
    </div>

    <!-- COSTO -->
    <div class="col-md-2">
        <label class="form-label">Costo unitario</label>
        <input type="number"
               name="costo"
               class="form-control"
               step="0.01"
               min="0"
               required>
    </div>

    <!-- TIPO DE PAGO -->
    <div class="col-md-2">
        <label class="form-label">Tipo de pago</label>
        <select name="tipo_pago" class="form-select" required>
            <option value="Efectivo">Efectivo</option>
            <option value="Transferencia">Transferencia</option>
            <option value="CrÃ©dito">CrÃ©dito</option>
        </select>
    </div>

    <div class="col-md-2 d-flex align-items-end">
        <button class="btn btn-primary w-100">
            Registrar compra
        </button>
    </div>
</form>

<hr>

<!-- =========================
     TABLA DE COMPRAS
========================= -->
<table class="table table-striped table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>ID</th>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Costo</th>
            <th>Total</th>
            <th>Pago</th>
            <th>Fecha</th>
            {% if session.rol == "admin" %}
            <th>AcciÃ³n</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for c in compras %}
        <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.producto }}</td>
            <td>{{ c.cantidad }}</td>
            <td>${{ c.costo }}</td>
            <td>${{ c.total }}</td>
            <td>{{ c.tipo_pago }}</td>
            <td>{{ c.fecha }}</td>
            {% if session.rol == "admin" %}
            <td>
                <a href="{{ url_for('compras.eliminar', id=c.id) }}"
                   class="btn btn-danger btn-sm"
                   onclick="return confirm('Â¿Eliminar compra?')">
                    ðŸ—‘ Eliminar
                </a>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="/" class="btn btn-outline-secondary mt-3">
    â¬… Volver al Inicio
</a>

<!-- =========================
     SCRIPT PRODUCTO
========================= -->
<script>
    const selectProducto = document.getElementById("productoSelect");
    const inputNombre = document.getElementById("productoNombre");

    selectProducto.addEventListener("change", () => {
        const option = selectProducto.options[selectProducto.selectedIndex];
        inputNombre.value = option.dataset.nombre || "";
    });
</script>

{% endblock %}
