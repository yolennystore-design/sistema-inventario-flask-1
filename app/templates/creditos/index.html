<tbody>
    {% if creditos %}
    {% for c in creditos %}
    <tr>
        <td>{{ loop.index }}</td>
        <td>{{ c.get("cliente", "") }}</td>

        <td>${{ "%.2f"|format(c.get("monto", 0)|float) }}</td>
        <td>${{ "%.2f"|format(c.get("abonado", 0)|float) }}</td>

        <td>
            {% if c.get("pendiente", 0)|float > 0 %}
            <strong class="text-danger">
                ${{ "%.2f"|format(c.get("pendiente", 0)|float) }}
            </strong>
            {% else %}
            <span class="text-success fw-bold">Pagado</span>
            {% endif %}
        </td>

        <td>{{ c.get("fecha", "") }}</td>

        <!-- ABONAR -->
        <td class="no-print">
            {% if c.get("pendiente", 0)|float > 0 %}
            {% if session.rol == "admin" %}
            <form method="POST"
                  action="{{ url_for('creditos.abonar', index=loop.index0) }}"
                  class="d-flex">
                <input type="number"
                       name="monto"
                       class="form-control me-2"
                       min="1"
                       max="{{ c.get('pendiente', 0)|float }}"
                       step="0.01"
                       required>
                <button type="submit"
                        class="btn btn-success btn-sm">
                    Abonar
                </button>
            </form>
            {% else %}
            <button class="btn btn-warning btn-sm"
                    onclick="solicitarAutorizacion()">
                🔒 Solicitar autorización
            </button>
            {% endif %}
            {% else %}
            <span class="text-muted">—</span>
            {% endif %}
        </td>

        <!-- PDF -->
        <td class="no-print text-center">
            <a href="{{ url_for('creditos.pdf_credito', index=loop.index0) }}"
               class="btn btn-outline-info btn-sm"
               target="_blank">
                🖨️ PDF
            </a>
        </td>

        <!-- ACCIONES ADMIN -->
        {% if session.rol == "admin" %}
        <td class="no-print text-center">
            <a href="{{ url_for('creditos.eliminar', index=loop.index0) }}"
               class="btn btn-danger btn-sm"
               onclick="return confirm('¿Eliminar este crédito?')">
                🗑️
            </a>

            <a href="{{ url_for('ventas.factura_por_numero', numero=c.get('numero_factura')) }}"
               class="btn btn-primary btn-sm ms-1">
                🧾 Ver factura
            </a>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
    {% else %}
    <tr>
        <td colspan="9" class="text-center text-muted">
            No hay créditos para mostrar
        </td>
    </tr>
    {% endif %}
</tbody>


    </table>
</div>

<!-- =========================
     VOLVER AL INICIO
========================= -->
<div class="mt-4">
    <a href="/" class="btn btn-outline-secondary">
        ⬅ Volver al inicio
    </a>
</div>

{% endblock %}

<!-- =========================
     CSS
========================= -->
<style>
    @media print {
        .no-print {
            display: none !important;
        }
    }
</style>
